/*
	html-xpath, an implementation of DOM Level 3 XPath for Internet Explorer 5+
	Copyright (C) 2004 Dimitri Glazkov

	This library is free software; you can redistribute it and/or
	modify it under the terms of the GNU Lesser General Public
	License as published by the Free Software Foundation; either
	version 2.1 of the License, or (at your option) any later version.

	This library is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
	Lesser General Public License for more details.

	You should have received a copy of the GNU Lesser General Public
	License along with this library; if not, write to the Free Software

        Here it is, license.txt.bz2 in base64 encoding:
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
*/

var isIe = /MSIE [56789]/.test(navigator.userAgent) && (navigator.platform == "Win32");

// Mozilla has support by default, we don't have an implementation for the rest
if (isIe)
{
	// release number
	document.DomL3XPathRelease = "0.0.3.0";
	
	// XPathException
	// An Error object will be thrown, this is just a handler to instantiate that object
	var XPathException = new _XPathExceptionHandler();
	function _XPathExceptionHandler()
	{
		this.INVALID_EXPRESSION_ERR = 51;
		this.TYPE_ERR = 52;
		this.NOT_IMPLEMENTED_ERR = -1;
		this.RUNTIME_ERR = -2;
		
		this.ThrowNotImplemented = function(message)
		{
			ThrowError(this.NOT_IMPLEMENTED_ERR, "This functionality is not implemented.", message);
		}
		
		this.ThrowInvalidExpression = function(message)
		{
			ThrowError(this.INVALID_EXPRESSION_ERR, "Invalid expression", message);
		}
		
		this.ThrowType = function(message)
		{
			ThrowError(this.TYPE_ERR, "Type error", message);
		}
		
		this.Throw = function(message)
		{
			ThrowError(this.RUNTIME_ERR, "Run-time error", message);
		}
		
		function ThrowError(code, description, message)
		{
			var error = new Error(code, "DOM-L3-XPath " + document.DomL3XPathRelease + ": " + description + (message ? ", \"" + message  + "\"": ""));
			error.code = code;
			error.name = "XPathException";
			throw error;
		}
	}
	
	// DOMException
	// An Error object will be thrown, this is just a handler to instantiate that object
	var DOMException = new _DOMExceptionHandler();
	function _DOMExceptionHandler()
	{
		this.ThrowInvalidState = function(message)
		{
			ThrowError(13, "The state of the object is no longer valid", message);
		}

		function ThrowError(code, description, message)
		{
			var error = new Error(code, "DOM : " + description + (message ? ", \"" + message  + "\"": ""));
			error.code = code;
			error.name = "DOMException";
			throw error;
		}
	}

	// XPathEvaluator 
	// implemented as document object methods
	
	// XPathExpression createExpression(String expression, XPathNSResolver resolver)
	document.createExpression = function
		(
		expression,		// String
		resolver		// XPathNSResolver
		)
	{
		// returns XPathExpression object
		return new XPathExpression(expression, resolver);
	}

	// XPathNSResolver createNSResolver(nodeResolver)
	document.createNSResolver = function
		(
		nodeResolver	// Node
		)
	{
		// returns XPathNSResolver
		return new XPathNSResolver(nodeResolver);
	}

	// XPathResult evaluate(String expresison, Node contextNode, XPathNSResolver resolver, Number type, XPathResult result)
	document.evaluate = function
		(
		expression,		// String
		contextNode,	// Node
		resolver,		// XPathNSResolver
		type,			// Number
		result			// XPathResult
		)
		// can raise XPathException, DOMException
	{
		// return XPathResult
		return document.createExpression(expression, resolver).evaluate(contextNode, type, result);
	}

	// XPathExpression
	function XPathExpression
	(
		expression, // String
		resolver // XPathNSResolver
	)
	{
		this.expressionString = expression;
		this.resolver = resolver;

		// XPathResult evaluate(Node contextNode, Number type, XPathResult result)
		this.evaluate = function
		(
			contextNode, // Node
			type, // Number
			result // XPathResult		
		)
			// raises XPathException, DOMException
		{
			// return XPathResult
			return (result && result.constructor == XPathResult ? result.initialize(this, contextNode, resolver, type) : new XPathResult(this, contextNode, resolver, type));
		}
		
		this.toString = function()
		{
			return "[XPathExpression]";
		}
	}

	// XPathNSResolver
	function XPathNSResolver(node)
	{
		this.node = node;
	
		// String lookupNamespaceURI(String prefix)
		this.lookupNamespaceURI = function
			(
			prefix			// String
			)
		{
			XPathException.ThrowNotImplemented();
			// return String
			return null;
		}

		this.toString = function()
		{
			return "[XPathNSResolver]";
		}
	}

	// XPathResult
	XPathResult.ANY_TYPE = 0;
	XPathResult.NUMBER_TYPE = 1;
	XPathResult.STRING_TYPE = 2;
	XPathResult.BOOLEAN_TYPE = 3;
	XPathResult.UNORDERED_NODE_ITERATOR_TYPE = 4;
	XPathResult.ORDERED_NODE_ITERATOR_TYPE = 5;
	XPathResult.UNORDERED_SNAPSHOT_TYPE = 6;
	XPathResult.ORDERED_SNAPSHOT_TYPE = 7;
	XPathResult.ANY_UNORDERED_NODE_TYPE = 8;
	XPathResult.FIRST_ORDERED_NODE_TYPE = 9;
	
	function XPathResult
			(
			expression,		// XPathExpression
			contextNode,	// Node
			resolver,		// XPathNSResolver
			type			// Number
			)
	{
		this.initialize = function(expression, contextNode, resolver, type)
		{
			this._domResult = null;
			this._expression = expression;
			this._contextNode = contextNode;
			this._resolver = resolver;
			if (type)
			{
				this.resultType = type;
				this._isIterator = (type == XPathResult.UNORDERED_NODE_ITERATOR_TYPE || 
					type == XPathResult.ORDERED_NODE_ITERATOR_TYPE || 
					type == XPathResult.ANY_TYPE);
				this._isSnapshot = (type == XPathResult.UNORDERED_SNAPSHOT_TYPE || type == XPathResult.ORDERED_SNAPSHOT_TYPE);
				this._isNodeSet = type > XPathResult.BOOLEAN_TYPE;
			}
			else
			{
				this.resultType = XPathResult.ANY_TYPE;
				this._isIterator = true;
				this._isSnapshot = false;
				this._isNodeSet = true;
			}
			return this;
		}
		
		this.initialize(expression, contextNode, resolver, type);
		
		this.getInvalidIteratorState = function()
		{
			return documentChangeDetected() || !this._isIterator;			
		}
		
		this.getSnapshotLength = function()
			// raises XPathException
		{
			if (!this._isSnapshot)
			{
				XPathException.ThrowType("Snapshot is not an expected result type");
			}
			activateResult(this);
			// return Number
			return this._domResult.length;
		}
		
		// Node iterateNext()
		this.iterateNext = function()
			// raises XPathException, DOMException
		{
			if (!this._isIterator)
			{
				XPathException.ThrowType("Iterator is not an expected result type");
			}
			activateResult(this);
			if (documentChangeDetected())
			{
				DOMException.ThrowInvalidState("iterateNext");
			}
			// return Node
			return getNextNode(this);
		}
		
		// Node snapshotItem(Number index)
		this.snapshotItem = function(index)
			// raises XPathException
		{
			if (!this._isSnapshot)
			{
				XPathException.ThrowType("Snapshot is not an expected result type");
			}
			// return Node
			return getItemNode(this, index); 
		}
		
		this.toString = function()
		{
			return "[XPathResult]";
		}
		
		// returns string value of the result, if result type is STRING_TYPE
		// otherwise throws an XPathException
		this.getStringValue = function()
		{
			if (this.resultType != XPathResult.STRING_TYPE)
			{
				XPathException.ThrowType("The expression can not be converted to return String");
			}
			return getNodeText(this);
		}
		
		// returns number value of the result, if the result is NUMBER_TYPE
		// otherwise throws an XPathException
		this.getNumberValue = function()
		{
			if (this.resultType != XPathResult.NUMBER_TYPE)
			{
				XPathException.ThrowType("The expression can not be converted to return Number");
			}
			var number = parseInt(getNodeText(this));
			if (isNaN(number))
			{
				XPathException.ThrowType("The result can not be converted to Number");
			}
			return number;
		}
		
		// returns boolean value of the result, if the result is BOOLEAN_TYPE
		// otherwise throws an XPathException
		this.getBooleanValue = function()
		{
			if (this.resultType != XPathResult.BOOLEAN_TYPE)
			{
				XPathException.ThrowType("The expression can not be converted to return Boolean");
			}
			
			var	
				text = getNodeText(this);
				bool = (text ? text.toLowerCase() : null);
			if (bool == "false" || bool == "true")
			{
				return bool;
			}
			XPathException.ThrowType("The result can not be converted to Boolean");
		}
		
		// returns single node, if the result is ANY_UNORDERED_NODE_TYPE or FIRST_ORDERED_NODE_TYPE
		// otherwise throws an XPathException
		this.getSingleNodeValue = function()
		{
			if (this.resultType != XPathResult.ANY_UNORDERED_NODE_TYPE && 
				this.resultType != XPathResult.FIRST_ORDERED_NODE_TYPE)
			{
				XPathException.ThrowType("The expression can not be converted to return single Node value");
			}
			return getSingleNode(this);
		}
		
		function documentChangeDetected()
		{
			return document._XPathMsxmlDocumentHelper.documentChangeDetected();
		}
		
		function getNodeText(result)
		{
			activateResult(result);
			return result._textResult;
//			return ((node = getSingleNode(result)) ? (node.nodeType == 1 ? node.innerText : node.nodeValue) : null);
		}
		
		function findNode(result, current)
		{
			switch(current.nodeType)
			{
				case 1: // NODE_ELEMENT
					var id = current.attributes.getNamedItem("id");
					if (id)
					{
						return document.getElementById(id.value);
					}
					XPathException.Throw("unable to locate element in XML tree");
				case 2: // NODE_ATTRIBUTE
					var id = current.selectSingleNode("..").attributes.getNamedItem("id");
					if (id)
					{
						var node = document.getElementById(id.text);
						if (node)
						{
							return node.attributes.getNamedItem(current.nodeName);
						}
					}
					XPathException.Throw("unable to locate attribute in XML tree");
				case 3: // NODE_TEXT
					var id = current.selectSingleNode("..").attributes.getNamedItem("id");
					if (id)
					{
						var node = document.getElementById(id.value);
						if (node)
						{
							for(child in node.childNodes)
							{
								if (child.nodeType == 3 && child.nodeValue == current.nodeValue)
								{
									return child;
								}
							}
						}
					}
					XPathException.Throw("unable to locate text in XML tree");
			}
			XPathException.Throw("unknown node type");
		}
		
		function activateResult(result)
		{
			if (!result._domResult)
			{
				try
				{
					var expression = result._expression.expressionString;
					
					// adjust expression if contextNode is not a document
					if (result._contextNode != document && expression.indexOf("//") != 0)
					{
						
						expression = "//*[@id = '" + result._contextNode.id + "']" + 
							(expression.indexOf("/") == 0 ? "" : "/") + expression;
					}
					
					if (result._isNodeSet)
					{
						result._domResult = document._XPathMsxmlDocumentHelper.getDom().selectNodes(expression);
					}
					else
					{
						result._domResult = true;
						result._textResult = document._XPathMsxmlDocumentHelper.getTextResult(expression);
					}
					
				}
				catch(error)
				{
					alert(error.description);
					XPathException.ThrowInvalidExpression(error.description);
				}
			}
		}

		function getSingleNode(result)
		{
			var node = getItemNode(result, 0);
			result._domResult = null;
			return node;
		}
		
		function getItemNode(result, index)
		{
			activateResult(result);
			var current = result._domResult.item(index);
			return (current ? findNode(result, current) : null);
		}
		
		function getNextNode(result)
		{
			var current = result._domResult.nextNode;
			if (current)
			{
				return findNode(result, current);
			}
			result._domResult = null;
			return null;
		}
	}
	
	document.reloadDom = function()
	{
		document._XPathMsxmlDocumentHelper.reset();
	}

	document._XPathMsxmlDocumentHelper = new _XPathMsxmlDocumentHelper();
	function _XPathMsxmlDocumentHelper()
	{
		this.getDom = function()
		{
			activateDom(this);
			return this.dom;
		}
		
		this.getXml = function()
		{
			activateDom(this);
			return this.dom.xml;
		}
		
		this.getTextResult = function(expression)
		{
			expression = expression.replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "\"");
			var xslText = "<xsl:stylesheet version=\"1.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\">" +
				"<xsl:output method=\"text\"/><xsl:template match=\"*\"><xsl:value-of select=\"" + expression + "\"/>" +
				"</xsl:template></xsl:stylesheet>";
			var xsl = new ActiveXObject("Msxml2.DOMDocument");
			xsl.loadXML(xslText);
			try
			{
				var result = this.getDom().transformNode(xsl);
			}
			catch(error)
			{
				alert("Error: " + error.description);
			}
			return result;
		}
		
		this.reset = function()
		{
			this.dom = null;
		}
		
		function onPropertyChangeEventHandler()
		{
			document._propertyChangeDetected = true;
		}
		
		this.documentChangeDetected = function()
		{
			return (document.ignoreDocumentChanges ? false : this._currentElementCount != document.all.length || document._propertyChangeDetected);
		}
		
		function activateDom(helper)
		{
			if (!helper.dom)
			{
				var dom = new ActiveXObject("Msxml2.DOMDocument");
				dom.async = false;
				dom.resolveExternals = false;
				loadDocument(dom, helper);
				helper.dom = dom;
				helper._currentElementCount = document.all.length;
				document._propertyChangeDetected = false;
			}
			else
			{
				if (helper.documentChangeDetected())
				{
					var dom = helper.dom;
					dom.load("");
					loadDocument(dom, helper);
					helper._currentElementCount = document.all.length;
					document._propertyChangeDetected = false;
				}
			}
		}
		
		function loadDocument(dom, helper)
		{
			return loadNode(dom, dom, document.body, helper);		
		}
		
		function loadNode(dom, domParentNode, node, helper)
		{
			if (node.nodeType == 3)
			{			
				domParentNode.appendChild(dom.createTextNode(node.nodeValue));
			}
			else
			{
				var domNode = dom.createElement(node.nodeName.toLowerCase());
				if (!node.id)
				{
					node.id = node.uniqueID;
				}
				domParentNode.appendChild(domNode);
				loadAttributes(dom, domNode, node);
				var length = node.childNodes.length;
				for(var i = 0; i < length; i ++ )
				{
					loadNode(dom, domNode, node.childNodes[i], helper);
				}
				node.attachEvent("onpropertychange", onPropertyChangeEventHandler);
			}
		}

		function loadAttributes(dom, domParentNode, node)
		{
			for (var i = 0; i < node.attributes.length; i ++ )
			{
				var attribute = node.attributes[i];
				var attributeValue = attribute.nodeValue;
				if (attributeValue && attribute.specified)
				{
					var domAttribute = dom.createAttribute(attribute.nodeName);
					domAttribute.value = attributeValue;
					domParentNode.setAttributeNode(domAttribute);				
				}
			}
		}
	
	}
}
else
{
	document.reloadDom = function() {}
	XPathResult.prototype.getStringValue = function()
	{
		return this.stringValue;
	}
	
	XPathResult.prototype.getNumberValue = function()
	{
		return this.numberValue;
	}
	
	XPathResult.prototype.getBooleanValue = function()
	{
		return this.booleanValue;
	}
	
	XPathResult.prototype.getSingleNodeValue = function()
	{
		return this.singleNodeValue;	
	}
	
	XPathResult.prototype.getInvalidIteratorState = function()
	{
		return this.invalidIteratorState;
	}
	
	XPathResult.prototype.getSnapshotLength = function()
	{
		return this.snapshotLength;
	}
	
	XPathResult.prototype.getResultType = function()
	{
		return this.resultType;
	}
}
